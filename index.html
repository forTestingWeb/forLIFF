<!DOCTYPE html>
<html>
<head>
<meta name="robots" content="noindex,nofollow,noarchive">
<meta name="viewport" content="user-scalable=no">
<link rel="stylesheet" type="text/css" media="all" href="style.css">
<title>読み込み中…</title>
<base target="_top">
<script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
<!-- -->
<div id="loader">
<p><br><br>　読み込み中…</p>
</div>

<iframe class="embed" name="_self" id="embed" allow="geolocation" src="about:blank"></iframe>
<script>
const loader = document.getElementById('loader');
var params = (new URL(document.location)).searchParams;
var lm="",op="",id="",title="";
var userId = "none";
var flag=0;
//if (params.get('code')) window.close();
if (liff.isInClient()) {
  liff.init({
    liffId: "2005353358-O06e5Z4z"
  }).then(() => {
//成功時の処理
    liff.ready.then(() => {
  // ここからLIFF SDKを使用可能
      if (liff.isLoggedIn()) loader.style.display="block";
      else liff.login();
      userId = liff.getDecodedIDToken().sub;
      jump();
  　}).catch((err) => {
//エラー時の処理
    });
  });
}else{
  liff.init({
    liffId: "2005353358-O06e5Z4z"
  }).then(() => {
//成功時の処理
  // ここからLIFF SDKを使用可能
    if (liff.isLoggedIn()) {
      loader.style.display="block";
      userId = liff.getDecodedIDToken().sub;
    } else {
      var ret = window.confirm("LINEでログインされていません。\n登録済み場合、ログインするとパスワード入力が不要になります。\nログインしますか？","はい","いいえ");
      if (ret) {
        var location = document.location;
        alert(location);
//        liff.login({ redirectUri: location });
        liff.login();
      }
    }
    jump();
  });
}

function jump(){
  if(params.get('lm')){
    lm = "lm="+params.get('lm');
    if(params.get('op')) op = "&op="+params.get('op');
    id = "&id="+userId;
    var src="https://script.google.com/macros/s/AKfycbwWm-EHjO4jl7-12xSMHG1QeW_fVoVov2NfP6RukE7Q2MHn9KM/exec?"+lm+op+id;
    const el = document.getElementById("embed");
    el.src=src;
  }
  var cs = 0; 
  for(var i=0;i<params.get('lm').length;i++){
    if (i!==8 && i!==9)cs=cs+parseInt(params.get('lm')[i]);
  }
  lm=Number(params.get('lm'));
  if ( lm % 100000 >= 50000){
    title = "区域番号"+lm%1000+"";
  }　else {
    if (lm%1000) title = lm%1000+"番の区域の閲覧";
    else title = "区域全体図の閲覧";
  }
  document.title = title;
  loader.classList.add('loaded');
}

</script>
</body>
</html>
